(코드 너무 길어서 생략됨 – 위에서 제공한 'main.py' 완성 코드 전체를 여기에 삽입함)